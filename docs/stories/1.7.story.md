# Story 1.7: Centralized Media Constants

## Status: Pending

## Story

- As a Developer
- I want to centralize all media type constants (MIME types and file extensions) in a shared module
- so that media validation is consistent across the application and eliminates code duplication.

## Acceptance Criteria (ACs)

- AC 7.1: Given media type definitions are currently scattered across multiple files, when I create a centralized constants module, then all supported image and video MIME types and extensions are defined in a single `src/constants/mediaTypes.js` file.
- AC 7.2: Given the centralized constants exist, when any module needs to validate or check media types, then it imports and uses the shared constants instead of defining its own.
- AC 7.3: Given the refactoring is complete, when I search the codebase for hardcoded media type strings, then no duplicates exist outside the centralized constants file.
- AC 7.4: Given the centralized constants are in use, when all tests are run, then they pass with the new shared validation logic.

## Tasks / Subtasks

- [ ] Task 1: Create centralized media constants module (AC: 7.1)
  - [ ] Subtask 1.1: Create `src/constants/` directory
  - [ ] Subtask 1.2: Create `src/constants/mediaTypes.js` with all supported MIME types
  - [ ] Subtask 1.3: Define supported image extensions array (JPG, PNG, GIF, HEIC, WebP)
  - [ ] Subtask 1.4: Define supported video extensions array (MP4, MOV, WebM, AVI, MKV)
  - [ ] Subtask 1.5: Define MIME type mappings for validation functions
  - [ ] Subtask 1.6: Export utility functions for media type validation
- [ ] Task 2: Identify and catalog current duplication (AC: 7.3)
  - [ ] Subtask 2.1: Search codebase for hardcoded image MIME types
  - [ ] Subtask 2.2: Search codebase for hardcoded video MIME types  
  - [ ] Subtask 2.3: Search codebase for hardcoded file extension patterns
  - [ ] Subtask 2.4: Document all locations requiring refactoring
- [ ] Task 3: Refactor MediaProcessor module (AC: 7.2)
  - [ ] Subtask 3.1: Replace hardcoded MIME types with imported constants
  - [ ] Subtask 3.2: Update validation logic to use centralized functions
  - [ ] Subtask 3.3: Remove duplicate constant definitions
  - [ ] Subtask 3.4: Verify media processing functionality unchanged
- [ ] Task 4: Refactor FileSystemFacade module (AC: 7.2)
  - [ ] Subtask 4.1: Replace hardcoded accept patterns with imported constants
  - [ ] Subtask 4.2: Update file type checking logic
  - [ ] Subtask 4.3: Remove duplicate MIME type arrays
  - [ ] Subtask 4.4: Verify file selection functionality unchanged
- [ ] Task 5: Update all test files (AC: 7.4)
  - [ ] Subtask 5.1: Replace hardcoded test MIME types with imported constants
  - [ ] Subtask 5.2: Update mock file creation to use centralized types
  - [ ] Subtask 5.3: Verify test coverage for new validation functions
  - [ ] Subtask 5.4: Ensure all tests pass with refactored constants
- [ ] Task 6: Final verification and cleanup (AC: 7.3, 7.4)
  - [ ] Subtask 6.1: Run comprehensive search for remaining hardcoded media types
  - [ ] Subtask 6.2: Verify no functionality regressions in media handling
  - [ ] Subtask 6.3: Run full test suite to confirm all tests pass
  - [ ] Subtask 6.4: Update documentation for new constants module

## Dev Technical Guidance

### Context & Purpose

This story addresses the significant code duplication discovered during Story 1.5 development. Media type constants (MIME types and file extensions) are currently scattered across multiple files, leading to maintenance issues and potential inconsistencies. Centralizing these constants improves maintainability and ensures consistent media validation.

### Current Duplication Analysis

**Files with duplicated media constants:**
- `src/mediaProcessor.js` - SUPPORTED_IMAGE_MIMES, SUPPORTED_VIDEO_MIMES arrays
- `src/facades/fileSystemFacade.js` - 'image/*' and 'video/*' extension mappings  
- Multiple test files - hardcoded MIME types in mock file creation
- Various modules - scattered 'image/jpeg', 'video/mp4', etc. references

### Proposed Constants Structure

```javascript
// src/constants/mediaTypes.js
export const SUPPORTED_IMAGE_EXTENSIONS = ['.jpg', '.jpeg', '.png', '.gif', '.heic', '.webp']
export const SUPPORTED_VIDEO_EXTENSIONS = ['.mp4', '.mov', '.avi', '.webm', '.mkv']

export const SUPPORTED_IMAGE_MIMES = [
  'image/jpeg', 'image/png', 'image/gif', 'image/heic', 'image/webp'
]

export const SUPPORTED_VIDEO_MIMES = [
  'video/mp4', 'video/quicktime', 'video/webm', 'video/avi', 'video/mkv'
]

export const FILE_ACCEPT_PATTERNS = {
  'image/*': SUPPORTED_IMAGE_EXTENSIONS,
  'video/*': SUPPORTED_VIDEO_EXTENSIONS
}

// Utility functions
export const isImageMime = (mimeType) => SUPPORTED_IMAGE_MIMES.includes(mimeType)
export const isVideoMime = (mimeType) => SUPPORTED_VIDEO_MIMES.includes(mimeType)
export const isSupportedMime = (mimeType) => isImageMime(mimeType) || isVideoMime(mimeType)
```

### Critical Considerations

1. **Backward Compatibility:** Ensure all existing functionality works identically
2. **Test Coverage:** All test files must be updated to use new constants
3. **Import Consistency:** Use consistent import patterns across modules
4. **Validation Logic:** Centralized validation functions should match existing behavior
5. **Performance:** No performance impact from centralized constants

### Testing Strategy

- Verify all media upload and validation workflows
- Test file type rejection for unsupported formats
- Validate MIME type detection in all contexts
- Ensure FileSystemAccessAPI accept patterns work correctly
- Run comprehensive test suite

## Story Progress Notes

### Agent Model Used: [To be filled by implementing agent]

### Completion Notes

[To be filled during implementation]

## Story DoD Checklist Report

- [ ] **Functionality**: All media validation works identically to before
- [ ] **Code Quality**: No duplicate constants exist in codebase
- [ ] **Testing**: All tests pass with new centralized constants
- [ ] **Error Handling**: Media type validation errors unchanged
- [ ] **Documentation**: Constants module properly documented
- [ ] **Integration**: All modules use centralized constants consistently
- [ ] **Performance**: No impact on media processing performance 