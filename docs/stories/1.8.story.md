# Story 1.8: Utility Functions Centralization

## Status: Pending

## Story

- As a Developer
- I want to create shared utility functions for common operations (filtering, validation, etc.)
- so that code duplication is eliminated and maintainability is improved.

## Acceptance Criteria (ACs)

- AC 8.1: Given filtering and validation logic is currently duplicated across modules, when I create shared utility functions, then common operations are centralized in `src/utils/` modules.
- AC 8.2: Given utility functions exist, when modules need to perform common operations (like media filtering or validation), then they import and use the shared utilities instead of implementing their own versions.
- AC 8.3: Given the refactoring is complete, when I analyze the codebase, then no duplicate utility logic exists across different modules.
- AC 8.4: Given shared utilities are implemented, when all tests are run, then they pass and demonstrate that the utilities work correctly across different contexts.

## Tasks / Subtasks

- [ ] Task 1: Create utility modules structure (AC: 8.1)
  - [ ] Subtask 1.1: Create `src/utils/` directory
  - [ ] Subtask 1.2: Create `src/utils/mediaUtils.js` for media-related utilities
  - [ ] Subtask 1.3: Create `src/utils/validationUtils.js` for validation helpers
  - [ ] Subtask 1.4: Create `src/utils/arrayUtils.js` for array manipulation utilities
  - [ ] Subtask 1.5: Create `src/utils/objectUtils.js` for object utilities if needed
- [ ] Task 2: Identify and catalog duplicate utility logic (AC: 8.3)
  - [ ] Subtask 2.1: Search for duplicate filtering functions across modules
  - [ ] Subtask 2.2: Identify repeated validation patterns
  - [ ] Subtask 2.3: Find duplicate array manipulation logic
  - [ ] Subtask 2.4: Document all utility functions that should be centralized
- [ ] Task 3: Implement media utilities (AC: 8.1)
  - [ ] Subtask 3.1: Create file extension extraction utility
  - [ ] Subtask 3.2: Create media type detection utility
  - [ ] Subtask 3.3: Create media filtering utilities (by type, by access, etc.)
  - [ ] Subtask 3.4: Create media pool management utilities
- [ ] Task 4: Implement validation utilities (AC: 8.1)
  - [ ] Subtask 4.1: Create file validation utilities
  - [ ] Subtask 4.2: Create input validation helpers
  - [ ] Subtask 4.3: Create type checking utilities
  - [ ] Subtask 4.4: Create error validation helpers
- [ ] Task 5: Implement array utilities (AC: 8.1)
  - [ ] Subtask 5.1: Create array filtering utilities
  - [ ] Subtask 5.2: Create array deduplication utilities
  - [ ] Subtask 5.3: Create array transformation utilities
  - [ ] Subtask 5.4: Create array search and find utilities
- [ ] Task 6: Refactor existing modules to use utilities (AC: 8.2)
  - [ ] Subtask 6.1: Update StateManager to use shared filtering utilities
  - [ ] Subtask 6.2: Update UIManager to use shared validation utilities
  - [ ] Subtask 6.3: Update MediaProcessor to use shared media utilities
  - [ ] Subtask 6.4: Update FileSystemAccessFacade to use shared utilities
- [ ] Task 7: Create comprehensive utility tests (AC: 8.4)
  - [ ] Subtask 7.1: Create test files for each utility module
  - [ ] Subtask 7.2: Test utilities in isolation with various inputs
  - [ ] Subtask 7.3: Test utilities integration across different modules
  - [ ] Subtask 7.4: Verify edge cases and error handling
- [ ] Task 8: Final verification and cleanup (AC: 8.3, 8.4)
  - [ ] Subtask 8.1: Search for remaining duplicate utility logic
  - [ ] Subtask 8.2: Verify all modules use shared utilities consistently
  - [ ] Subtask 8.3: Run full test suite to ensure no regressions
  - [ ] Subtask 8.4: Update documentation for new utility modules

## Dev Technical Guidance

### Context & Purpose

This story addresses code duplication identified during the comprehensive analysis. Common operations like filtering, validation, and array manipulation are repeated across multiple modules, leading to maintenance overhead and potential inconsistencies. Centralizing these utilities improves code quality and maintainability.

### Current Duplication Analysis

**Identified duplicate patterns:**
- Media filtering logic in StateManager and UIManager
- File validation patterns in multiple facades
- Array filtering operations across modules  
- Object property checking in various components
- Error handling patterns

### Proposed Utility Structure

```javascript
// src/utils/mediaUtils.js
export const getFileExtension = (filename) => { /* implementation */ }
export const getMediaType = (file) => { /* implementation */ }
export const filterMediaByType = (mediaItems, type) => { /* implementation */ }
export const filterMediaByAccess = (mediaItems, hasAccess) => { /* implementation */ }

// src/utils/validationUtils.js
export const isValidFile = (file) => { /* implementation */ }
export const isValidArray = (arr) => { /* implementation */ }
export const validateInput = (input, rules) => { /* implementation */ }

// src/utils/arrayUtils.js
export const filterUnique = (array, keyFn) => { /* implementation */ }
export const findByProperty = (array, property, value) => { /* implementation */ }
export const groupBy = (array, keyFn) => { /* implementation */ }
```

### Refactoring Strategy

1. **Extract Patterns:** Identify common code patterns that appear 2+ times
2. **Create Generic Functions:** Design utilities that work across different contexts
3. **Gradual Migration:** Refactor one module at a time to use new utilities
4. **Test Thoroughly:** Ensure utilities work correctly in all usage contexts
5. **Clean Up:** Remove old duplicate implementations after migration

### Critical Considerations

1. **Function Signatures:** Design flexible, reusable function interfaces
2. **Error Handling:** Utilities should handle edge cases gracefully
3. **Performance:** No performance degradation from utility abstraction
4. **Testing:** Comprehensive test coverage for all utility functions
5. **Documentation:** Clear JSDoc for all utility functions

### Testing Strategy

- Unit tests for each utility function
- Integration tests showing utilities work across modules
- Edge case testing (null, undefined, empty inputs)
- Performance testing for array operations
- Regression testing for existing functionality

## Story Progress Notes

### Agent Model Used: [To be filled by implementing agent]

### Completion Notes

[To be filled during implementation]

## Story DoD Checklist Report

- [ ] **Functionality**: All existing functionality preserved with utilities
- [ ] **Code Quality**: No duplicate utility logic exists
- [ ] **Testing**: Comprehensive test coverage for all utilities
- [ ] **Error Handling**: Utilities handle edge cases gracefully  
- [ ] **Documentation**: All utilities properly documented with JSDoc
- [ ] **Integration**: All modules consistently use shared utilities
- [ ] **Performance**: No performance impact from utility abstraction 