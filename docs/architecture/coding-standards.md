# Coding Standards

These standards are mandatory for all code generated by AI agents and human developers for the VJ Tam Tam project. Adherence to these standards is crucial for maintainability, readability, and consistency. The use of `npm` for managing development-time linters and formatters is approved to enforce these standards automatically.

## Primary Runtime(s)

- **Application Runtime:** Modern evergreen web browsers (Chrome, Firefox, Safari, Edge) supporting ES6+ JavaScript modules natively.
- **Development Tooling Runtime:** Node.js (latest LTS version recommended) will be required on developer machines to run `npm` for linters, formatters, and test runners.
- **Local Development Server:** For serving the application locally, a simple static file server (like `serve` via `npx serve` or Python's `http.server`) is recommended to avoid browser restrictions with `file:///` URLs.

## Style Guide, Linter & Formatter

- **Formatter (Automated):**
  - **Tool:** Prettier.
  - **Configuration:** Prettier will be configured to enforce consistent code style, including:
    - **No Semicolons:** Semicolons will be omitted, relying on JavaScript's Automatic Semicolon Insertion (ASI), with Prettier ensuring correctness.
    - Single quotes (`'`) for strings.
    - Tab width: 2 spaces.
    - Trailing commas: `es5`.
    - Print width: 100.
  - A `.prettierrc.json` (or similar) configuration file will be included in the project root.
  - A `.prettierignore` file will be used to exclude specific files/directories (like `/lib/`).
- **Linter (Automated):**
  - **Tool:** ESLint.
  - **Configuration:** ESLint will be configured for strict adherence to best practices and error prevention. The configuration (e.g., in `.eslintrc.json`) will include:
    - `extends: "eslint:recommended"`
    - Parser options for ES Modules (`sourceType: "module"`, `ecmaVersion: "latest"`).
    - Environment set to `browser: true` and `es2021: true` (or latest ES version).
    - Plugins for enhanced linting (e.g., `eslint-plugin-import` for module import/export sanity, `eslint-plugin-promise` for promise best practices).
    - **Strict Rules:** Custom rules will be enabled to enforce high code quality, such as:
      - `no-unused-vars` (error).
      - `no-console` (warn during development).
      - `eqeqeq` (error, enforce `===` and `!==`).
      - `curly` (error, enforce braces for all control statements).
  - A `.eslintignore` file will be used to exclude specific files/directories.
- **Tooling Management & Execution:**
  - ESLint and Prettier (and any plugins) will be installed as development dependencies via `npm` and listed in `package.json`.
  - `npm` scripts will be provided in `package.json` for running the linter and formatter (e.g., `npm run lint`, `npm run format`).
  - Developers should integrate these tools with their IDEs for real-time feedback and auto-formatting on save.
  - Consideration for pre-commit hooks (e.g., using Husky and lint-staged) to automatically lint and format staged files.

## Naming Conventions (Enforced by Linter where possible)

- **Variables & Functions:** `camelCase` (e.g., `mediaItem`, `calculateDuration`).
- **Classes (if used, sparingly):** `PascalCase` (e.g., `MappingManager`). The project prefers a functional programming style.
- **Constants:** `UPPER_SNAKE_CASE` (e.g., `DEFAULT_DURATION`, `MAX_TEXT_ENTRIES`).
- **Files:** `camelCase.js` for `src/` files (e.g., `playbackEngine.js`, `uiManager.js`). Test files: `camelCase.test.js` or `camelCase.spec.js`.
- **Modules (Conceptual):** `camelCase` when referring to the module's primary export or purpose.

## File Structure

- Strict adherence to the project structure defined in **Section 7: Project Structure** and the initial structure envisioned in the PRD.
- New files must be placed in the appropriate, agreed-upon locations.

## Unit Test File Organization & Naming

- Test files (e.g., `playbackEngine.test.js` or `playbackEngine.spec.js`) will typically be co-located with the source files they test or reside in a `__tests__` subdirectory within the module's folder (e.g., `src/playbackEngine/__tests__/playbackEngine.test.js`).

## Asynchronous Operations

- **Promises & `async/await`:** Standard ES6+ Promises and `async/await` syntax must be used for all asynchronous operations.
- **Error Handling:** All Promises must have error handling (e.g., `catch()` blocks or `try...catch` with `await`). ESLint rules (e.g., from `eslint-plugin-promise`) will help enforce this. Unhandled promise rejections should be avoided.

## Type Safety & Clarity

- **JSDoc for Type Annotation:** Crucial for clarity. JSDoc comments **must** be used for all functions, detailing parameters (with `@param {type} name - description`) and return values (`@returns {type} - description`). Complex object shapes used as parameters or return types should also be defined using `@typedef` or documented inline. ESLint can be configured with plugins like `eslint-plugin-jsdoc` to enforce JSDoc presence and correctness.

  - Example:

    ```javascript
    /**
     * @typedef {object} PlaybackSettings
     * @property {number} minSegmentDuration - Minimum segment duration.
     * @property {number} maxSegmentDuration - Maximum segment duration.
     */

    /**
     * Calculates the display duration for a media segment.
     * @param {{duration: number}} mediaItem - The media item object.
     * @param {PlaybackSettings} settings - The current playback settings.
     * @returns {number} The calculated segment duration in seconds.
     */
    function calculateSegmentDuration(mediaItem, settings) {
      // ...
    }
    ```

- **Equality:** ESLint rule `eqeqeq` will enforce strict equality (`===`) and inequality (`!==`).

## Comments & Documentation

- **Code Comments:** Explain _why_ complex or non-obvious code exists, not _what_ it does.
- **JSDoc:** Mandatory for all non-trivial functions as per 15.7.
- **Module-Level Comments:** Each JavaScript file/module should start with a brief JSDoc comment block (`/** ... */`) explaining its overall responsibility.

## Dependency Management (Application Code)

- **Minimize Application Dependencies:** The core application deployed to GitHub Pages must remain Vanilla JS with minimal, locally-hosted libraries (like Maptastic.js in `/lib/`) that do not require a build step for the _application itself_.
- **Development Dependencies:** Managed via `npm` and `package.json` (`devDependencies`). These are for tooling (linters, formatters, test runners) and are not part of the deployed application bundle.
- **Adding New Application Dependencies:** Introducing new external libraries for the _application itself_ must be explicitly discussed, justified, and approved, adhering to the "minimal, locally-hosted, no-build-step for application" criteria.

## Detailed Language & Framework Conventions (Vanilla JavaScript)

- **ES Modules:** Use ES6+ module syntax (`import`/`export`) exclusively. Enforced by ESLint.
- **Strict Mode:** `'use strict';` should be declared at the beginning of all JavaScript files (can be enforced by ESLint).
- **Immutability:** Prefer immutable patterns. Avoid direct mutation of objects/arrays received as parameters or from state; return new instances instead.
- **Functional Programming Style:** Favor a functional programming style as per PRD. Pure functions, array methods (`map`, `filter`, `reduce`), and avoiding classes unless strongly justified.
- **Error Handling:** Adhere to **Section 14: Error Handling Strategy**.
- **Null/Undefined Handling:** Explicit checks. Avoid relying on truthy/falsy for `null`/`undefined` if distinction is important. Default parameters for functions.
- **DOM Manipulation:** Encapsulate within UI-focused modules. Use efficient, standard Vanilla JS DOM APIs.
- **Global Variables:** Avoid. Use ES modules. ESLint rule `no-undef` will help.
- **Modifying Built-in Prototypes:** Forbidden.
- **Code Generation Anti-Patterns to Avoid (ESLint rules will help):**
  - Overly nested conditionals (ESLint: `max-depth`).
  - Large, monolithic functions (promote refactoring).
  - Code difficult to test.
  - Ignoring JSDoc.
